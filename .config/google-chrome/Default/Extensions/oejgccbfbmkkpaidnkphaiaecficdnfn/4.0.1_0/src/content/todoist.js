const u=document.getElementById("content");togglbutton.render("[data-item-detail-root]:not(.toggl)",{observe:!0},t=>{const e=t.querySelector("[data-item-actions-root]");if(e&&e.children.length)return;const o=()=>t.dataset.itemContent||"",r=()=>t.dataset.itemProjectName||"",n=t.closest("[role=dialog]"),i=()=>Array.from(n.querySelectorAll("[data-item-label-name]")).map(c=>c.dataset.itemLabelName).filter(Boolean),a=togglbutton.createTimerLink({className:"todoist-detail",description:o,projectName:r,buttonType:"minimal",tags:i,container:'[data-testid="button-container"]'}),l=$(".toggl-button-todoist-wrapper");if(l){l.replaceChildren(a);return}const s=document.createElement("div");s.classList.add("toggl-button-todoist-wrapper"),s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.width="32px",s.appendChild(a),n.querySelector("header").firstChild.lastChild.firstChild.prepend(s)});togglbutton.render("[data-item-detail-root] [data-item-actions-root]:not(.toggl)",{observe:!0},t=>{const e=()=>t.dataset.itemContent||"",o=()=>t.dataset.itemProjectName||"",r=t.closest(".item_overview_main"),n=()=>Array.from(r.querySelectorAll("[data-item-label-name]")).map(l=>l.dataset.itemLabelName).filter(Boolean),i=togglbutton.createTimerLink({className:"todoist-detail",description:e,projectName:o,tags:n,buttonType:"minimal"}),a=document.createElement("div");a.classList.add("item_action"),a.style.display="flex",a.style.alignItems="center",a.style.justifyContent="center",a.appendChild(i),t.lastChild.before(a)});togglbutton.render(".task_list_item .task_list_item__actions:not(.toggl)",{observe:!0,observeTarget:u,debounceInterval:300},t=>{if(t.querySelector(".toggl-button")!==null)return;const o=t.closest(".task_list_item"),r=o.querySelector(".task_list_item__content"),n=()=>{const c=r.querySelector(".task_content");return c?c.textContent.trim():""};let i="";const a=o.getAttribute("data-item-id");if(document.querySelector(".project_view h1 span.simple_content"))i=document.querySelector(".project_view h1 span.simple_content").textContent.trim();else if(document.getElementById(`item_${a}`)){const c=document.getElementById(`item_${a}`).querySelector(".content");i=j(c)}else o.querySelector(".task_list_item__project")?i=o.querySelector(".task_list_item__project").textContent.trim():document.querySelector("[data-project-id] .simple_content")?i=document.querySelector("[data-project-id] .simple_content").textContent:i=C(t.closest(".item_detail"));const l=()=>[...r.querySelectorAll(".task_list_item__info_tags__label")].map(p=>p.textContent),s=togglbutton.createTimerLink({className:"todoist-detail-subtask",description:n,projectName:i,buttonType:"minimal",tags:l}),d=document.createElement("div");d.style.display="flex",d.style.marginTop="2px",d.appendChild(s),t.lastChild.before(d)});function _(t){let e="";const o=$(".project_item__name",t.parentNode.parentNode);return o?e=o.textContent.trim():$(".task_list_item__project",t.parentNode.parentNode)&&(e=$(".task_list_item__project",t).textContent.trim()),e}function g(t){const e=/(?:^|\s)indent_(\d*?)(?:\s|$)/,o=t.className.match(e)[1],r="indent_"+(o-1);let n=t;for(;n.previousElementSibling&&(n=n.previousElementSibling,!n.classList.contains(r)););return n}function f(t){return t.classList.contains("indent_1")}function m(t){const e=$(".name",t).firstChild.textContent.trim();if(f(t))return[e];const o=g(t);return[e].concat(m(o))}function b(t){return t.startsWith("_")}function y(t){let e,o,r,n;const i=t.closest(".project_editor_instance");return i&&(e=i.getAttribute("data-project-id"),o=$("#project_list"),b(e)?n=$(".current",o):(r=$("#project_color_"+e,o),r&&(n=r.closest(".menu_clickable")))),n}function j(t){return()=>{let e,o;return $("#filter_inbox.current, #filter_team_inbox.current")?e=["Inbox"]:(o=y(t),o?e=m(o):e=[_(t)]),e}}function C(t){if(!t)return"";const e=t.querySelector(".item_detail_parent_info");let o="";return e.querySelector("circle, .item_detail_parent_icon__inbox_icon")&&(o=e.querySelector(".item_detail_parent_name").textContent),o}
