import{b as c,B as y}from"./browser-polyfill.js";import{B as I,a as h,f as k,e as u,I as C,D as v,j as D,s as F}from"./errorReport.js";import{i as $,d as j}from"./intl.js";const d=a=>{const t={...a};for(const s in a)(t[s]===void 0||t[s]===null||t[s]==="")&&delete t[s];const e=new URLSearchParams(t).toString();return e?`?${e}`:""},n=a=>({headers:{...a.reduce((t,e)=>({...t,...e()}),{})}}),p=a=>a==="true"?{"x-toggl-permissions":a}:{};class R extends I{constructor(){super(...arguments),this.accounts={closeAccount:{track:t=>this.post("/api/me/close_account/track",{body:JSON.stringify(t),credentials:"include"},"accounts")},me:{fetch:()=>this.get("/api/me",{credentials:"include"},"accounts"),update:t=>this.put("/api/me",{body:JSON.stringify(t),credentials:"include"},"accounts")},sessions:{check:()=>this.get("/api/sessions",{credentials:"include"},"accounts"),login:t=>this.post("/api/sessions",{body:JSON.stringify(t),credentials:"include"},"accounts"),logout:(t=!1)=>this.delete("/api/sessions",{body:JSON.stringify({close_all_sessions:t}),credentials:"include"},"accounts")},signup:t=>this.post("/api/signup",{body:JSON.stringify(t),credentials:"include"},"accounts"),sso:{profiles:{fetch:()=>this.get("/sso/api/profiles",{credentials:"include"},"accounts")}}},this.analytics={charts:{create:t=>this.post("/analytics/api/charts",{body:JSON.stringify(t)}),list:t=>this.get(`/analytics/api/charts?organization_id=${t}`),fetch:t=>this.get(`/analytics/api/charts/${t}`),update:(t,e)=>this.patch(`/analytics/api/charts/${t}`,{body:JSON.stringify(e)}),delete:t=>this.delete(`/analytics/api/charts/${t}`),userOptions:{update:(t,e)=>this.patch(`/analytics/api/charts/${t}/user_options`,{body:JSON.stringify(e)})},privileges:{update:(t,e)=>this.patch(`/analytics/api/charts/${t}/privileges`,{body:JSON.stringify({permissions:e})}),delete:(t,e)=>this.delete(`/analytics/api/charts/${t}/privileges/${e.source}/${e.id}`)},tokens:{update:(t,e)=>this.patch(`/analytics/api/charts/${t}/tokens`,{body:JSON.stringify(e)})},dashboards:{list:t=>this.get(`/analytics/api/charts/${t}/dashboards`)}},dashboards:{create:t=>this.post("/analytics/api/dashboards",{body:JSON.stringify(t)}),list:t=>this.get(`/analytics/api/dashboards?organization_id=${t}`),fetch:t=>this.get(`/analytics/api/dashboards/${t}`),update:(t,e)=>this.patch(`/analytics/api/dashboards/${t}`,{body:JSON.stringify(e)}),delete:t=>this.delete(`/analytics/api/dashboards/${t}`),charts:{fetch:t=>this.get(`/analytics/api/dashboards/${t}/charts`)},userOptions:{update:(t,e)=>this.patch(`/analytics/api/dashboards/${t}/user_options`,{body:JSON.stringify(e)})},privileges:{update:(t,e)=>this.patch(`/analytics/api/dashboards/${t}/privileges`,{body:JSON.stringify({permissions:e})}),delete:(t,e)=>this.delete(`/analytics/api/dashboards/${t}/privileges/${e.source}/${e.id}`)},tokens:{update:(t,e)=>this.patch(`/analytics/api/dashboards/${t}/tokens`,{body:JSON.stringify(e)})}},exports:{chart:(t,e,s)=>this.post(`exports/api/v1/chart.${e}${d({useToken:s?!0:void 0})}`,{body:JSON.stringify(t)}),dashboard:(t,e,s)=>this.post(`exports/api/v1/dashboard.${e}${d({useToken:s?!0:void 0})}`,{body:JSON.stringify(t)})},shared:{fetch:t=>this.get(`/analytics/api/shared/${t}`)}},this.approvals={timesheetSetup:{list:(t,e)=>{const s=d(e);return this.get(`/api/v9/workspaces/${t}/timesheet_setups${s}`)},update:(t,e,s)=>this.put(`/api/v9/workspaces/${t}/timesheet_setups/${e}`,{body:JSON.stringify(s)}),create:(t,e)=>this.post(`/api/v9/workspaces/${t}/timesheet_setups`,{body:JSON.stringify(e)}),delete:(t,e)=>this.delete(`/api/v9/workspaces/${t}/timesheet_setups/${e}`)},timesheet:{list:(t,e)=>{const s=d(e);return this.get(`/api/v9/workspaces/${t}/timesheets${s}`)},hours:(t,e)=>this.post(`/api/v9/workspaces/${t}/timesheets/hours`,{body:JSON.stringify(e)}),update:(t,e,s,i)=>this.put(`/api/v9/workspaces/${t}/timesheets/${e}/${s}`,{body:JSON.stringify(i)}),timeEntries:(t,e,s)=>this.get(`/api/v9/workspaces/${t}/timesheets/${e}/${s}/time_entries`)}},this.auth={saml2login:({email:t,client:e})=>this.get(`/api/v9/auth/saml2/login?email=${t}&client=${e}`)},this.avatar={gravatar:()=>this.post("/api/v9/avatars/use_gravatar",{body:JSON.stringify({})}),remove:()=>this.delete("/api/v9/avatars"),upload:t=>{const e=new FormData;return e.append("file",t),this.post("/api/v9/avatars",{body:e})}},this.calendar={deleteCalendarIntegration:t=>this.delete(`/api/v9/integrations/calendar/${t}`),fetchCalendarIntegrationCalendars:(t,e,s)=>{const i={selected_only:e.toString()};s&&(i.page_token=s);const r="?"+new URLSearchParams(i);return this.get(`/api/v9/integrations/calendar/${t}/calendars${r}`)},fetchCalendarIntegrations:()=>this.get("/api/v9/integrations/calendar"),fetchCalendarIntegrationEvents:(t,e,s)=>{const i={start_date:t,end_date:e};s&&(i.page_token=s);const r="?"+new URLSearchParams(i);return this.get(`/api/v9/integrations/calendar/events${r}`)},getEventDetailsSuggestion:t=>this.get(`/api/v9/integrations/calendar/events/${t}/details-suggestion`),refreshCalendarList:t=>this.post(`/api/v9/integrations/calendar/${t}/calendars/update`),refreshEvents:()=>this.post("/api/v9/integrations/calendar/events/update"),updateCalendar:(t,e,s)=>this.patch(`/api/v9/integrations/calendar/${t}/calendars/${e}`,{body:JSON.stringify(s)}),getBulkEventDetailsSuggestion:t=>this.post("/api/v9/integrations/calendar/events/details-suggestion",{body:JSON.stringify(t)})},this.client={archive:t=>this.post(`/api/v9/workspaces/${t.wid}/clients/${t.id}/archive`),create:t=>this.getPermissions().then(e=>this.post(`/api/v9/workspaces/${t.wid}/clients`,{body:JSON.stringify(t),...n([()=>p(e)])})),delete:t=>this.delete(`/api/v9/workspaces/${t.wid}/clients/${t.id}`),fetch:(t,e)=>{const i={status:(e==null?void 0:e.active)==="both"?"both":(e==null?void 0:e.active)===!0?"active":(e==null?void 0:e.active)===!1?"archived":"active"};e!=null&&e.name&&(i.name=e.name);const r=new URLSearchParams(i);return this.getPermissions().then(o=>this.get(`/api/v9/workspaces/${t}/clients?${r.toString()}`,n([()=>p(o)])))},restore:(t,e)=>this.getPermissions().then(s=>this.post(`/api/v9/workspaces/${t.wid}/clients/${t.id}/restore`,{body:JSON.stringify(e==="all"?{restore_all_projects:!0}:{projects:e}),...n([()=>p(s)])})),update:t=>this.getPermissions().then(e=>this.put(`/api/v9/workspaces/${t.wid}/clients/${t.id}`,{body:JSON.stringify(t),...n([()=>p(e)])}))},this.countries={fetch:()=>this.get("/api/v9/countries"),fetchStates:t=>this.get(`/api/v9/countries/${t}/subdivisions`)},this.csv={import:t=>{const e=new FormData;return e.append("upload_id",""+t.uploadId),e.append("api_token",t.apiToken),e.append("workspace_id",""+t.workspaceId),e.append("toggl_new","true"),t.sendInvites&&e.append("send_invites","1"),this.post("/api/csv/import",{body:e})},status:t=>{const e=new FormData;return e.append("upload_id",""+t.uploadId),e.append("api_token",t.apiToken),e.append("workspace_id",""+t.workspaceId),e.append("toggl_new","true"),this.post("/api/csv/status",{body:e})},validate:t=>{const e=new FormData;return e.append("filedata",t.file),e.append("api_token",t.apiToken),e.append("workspace_id",""+t.workspaceId),e.append("toggl_new","true"),this.post("/api/csv/validate",{body:e})}},this.currencies=()=>this.get("/api/v9/currencies"),this.feedback={send:t=>{const e=new FormData;return t.subject&&e.append("subject",t.subject),e.append("details",t.details),e.append("date",t.date),e.append("toggl_version",t.toggl_version),this.post("/api/v9/feedback/web",{body:e})}},this.flags={change:t=>this.post("/api/v9/me/flags",{body:JSON.stringify(t)}),fetch:()=>this.get("/api/v9/me/flags")},this.insights={workspace:{dataTrends:{projects:(t,e)=>this.post(`/insights/api/v1/workspace/${t}/data_trends/projects`,{body:JSON.stringify(e)})},profitability:{employeesExport:(t,e,s)=>this.post(`insights/api/v1/workspace/${t}/profitability/employees.${s}`,{body:JSON.stringify(e)}),projectsExport:(t,e,s)=>this.post(`insights/api/v1/workspace/${t}/profitability/projects.${s}`,{body:JSON.stringify(e)})},trends:{projectsExport:(t,e,s)=>this.post(`/insights/api/v1/workspace/${t}/trends/projects.${s}`,{body:JSON.stringify(e)})}}},this.integrations={authService:(t,e,s)=>this.post(`/integrations/api/v2/auth/${t}/${e}`,{body:JSON.stringify({redirect_url:s}),credentials:"include"}),createConfiguration:(t,e,s,i)=>this.post(`/integrations/api/v2/services/${t}/${e}`,{body:JSON.stringify({enabled:i,configuration:s})}),deleteConfiguration:(t,e)=>this.delete(`/integrations/api/v2/services/${t}/${e}`),getIntegrations:t=>this.get(`/integrations/api/v2/services/${t}`),removeAuthService:(t,e)=>this.delete(`/integrations/api/v2/auth/${t}/${e}`),setServiceEnabled:(t,e,s)=>this.patch(`/integrations/api/v2/services/${t}/${e}`,{body:JSON.stringify({enabled:s})}),sync:(t,e)=>this.post(`/integrations/api/v2/sync/${t}/${e}`),updateConfiguration:(t,e,s,i)=>this.put(`/integrations/api/v2/services/${t}/${e}`,{body:JSON.stringify({enabled:i,configuration:s})}),validateJira2Filtering:(t,e,s)=>this.post(`/integrations/api/v2/services/${t}/jira2/validate`,{body:JSON.stringify({...s,jira_active_site:e})}),getQuickBooksCustomers:t=>this.get(`/integrations/api/v2/services/${t}/quickbooks/customers`),submitInvoiceToQuickBooks:(t,e)=>this.post(`/integrations/api/v2/services/${t}/quickbooks/invoices`,{body:JSON.stringify(e)})},this.invitations={invitation:t=>this.get(`/api/v9/invitations/${t}`)},this.location=()=>this.get("/api/v9/me/location"),this.me={acceptTermsOfService:()=>this.post("/api/v9/me/accept_tos"),changePassword:(t,e)=>this.put("/api/v9/me",{body:JSON.stringify({current_password:t,password:e})}),clients:{list:t=>this.getPermissions().then(e=>this.get(`/api/v9/me/clients${t?`?since=${t}`:""}`,n([()=>p(e)])))},closeAccount:t=>this.post("/api/v9/me/close_account",{body:JSON.stringify(t)}),disableOAuth:{apple:()=>this.post("/api/v9/me/enable_oauth/apple",{body:JSON.stringify({enabled:!1})}),google:()=>this.post("/api/v9/me/enable_oauth/google",{body:JSON.stringify({enabled:!1})})},enableOAuth:{apple:t=>this.post("/api/v9/me/enable_oauth/apple",{body:JSON.stringify({enabled:!0,token:t})}),google:t=>this.post("/api/v9/me/enable_oauth/google",{body:JSON.stringify({enabled:!0,code:t})})},enableSso:t=>this.post("/api/v9/me/enable_sso",{body:JSON.stringify(t)}),export:{create:t=>this.post("/api/v9/me/export",{body:JSON.stringify(t)}),get:()=>this.get("/api/v9/me/export")},favorites:{create:(t,e=!1)=>this.post(`/api/v9/me/favorites${e?"?meta=true":""}`,{body:JSON.stringify(t)}),update:(t,e=!1)=>this.put(`/api/v9/me/favorites${e?"?meta=true":""}`,{body:JSON.stringify(t)}),delete:t=>this.delete(`/api/v9/me/favorites/${t}`),list:(t=!1)=>this.getPermissions().then(e=>this.get(`/api/v9/me/favorites${t?"?meta=true":""}`,n([()=>p(e)]))),suggestions:()=>this.post("/api/v9/me/favorites/suggestions")},features:{list:()=>this.get("/api/v9/me/features"),organization:{list:()=>this.get("/api/v9/me/features?for_organization=true")}},get:()=>this.get("/api/v9/me"),login:t=>this.post("/api/v9/me/sessions",{headers:{Authorization:`Basic ${btoa(unescape(encodeURIComponent("email"in t?`${t.email}:${t.password}`:"apiToken"in t?`${t.apiToken}:api_token`:"code"in t?`${t.code}:${t.method}`:"token"in t?`${t.token}:${t.method}`:"")))}`},body:JSON.stringify({remember_me:!0})}),logout:()=>this.delete("/api/v9/me/sessions"),lostPasswords:t=>this.post("/api/v9/me/lost_passwords",{body:JSON.stringify(t)}),lostPasswordsToken:t=>this.get(`/api/v9/me/lost_passwords/${t}`),lostPasswordsNewPassword:t=>this.post("/api/v9/me/lost_passwords/confirm",{body:JSON.stringify(t)}),notifications:{delete:t=>this.put(`api/v9/me/notifications/${t}/seen`,{body:JSON.stringify({})}),list:()=>this.get("/api/v9/me/notifications")},organizations:{list:()=>this.getPermissions().then(t=>this.get("/api/v9/me/organizations",n([()=>p(t)])))},preferences:{fetch:()=>this.get("/api/v9/me/preferences/web"),update:t=>this.post("/api/v9/me/preferences/web",{body:JSON.stringify(t)})},projects:{list:t=>this.getPermissions().then(e=>this.get(`/api/v9/me/projects${t?`?since=${t}`:""}`,n([()=>p(e)])))},reminders:{list:()=>this.getPermissions().then(t=>this.get("/api/v9/me/track_reminders",n([()=>p(t)])))},resetToken:()=>this.post("/api/v9/me/reset_token"),tags:{list:t=>this.getPermissions().then(e=>this.get(`/api/v9/me/tags${t?`?since=${t}`:""}`,n([()=>p(e)])))},tasks:{list:(t,e)=>{const s=d({since:t,meta:e});return this.getPermissions().then(i=>this.get(`/api/v9/me/tasks${s}`,n([()=>p(i)])))}},timeEntries:{current:()=>this.getPermissions().then(t=>this.get("/api/v9/me/time_entries/current",n([()=>p(t)]))),fetch:(t,e,s=!1,i=!1)=>{let r;t&&e?r={end_date:new Date(e).toISOString().substring(0,10),start_date:new Date(t).toISOString().substring(0,10)}:r=e?{before:new Date(e).toISOString().substring(0,10)}:{since:t?Math.floor(new Date(t).getTime()/1e3).toString():""};const o=d({...r,meta:s,include_sharing:i});return this.getPermissions().then(g=>this.get(`/api/v9/me/time_entries${o}`,n([()=>p(g)])))},list:(t,e=!1)=>this.getPermissions().then(s=>this.get(`/api/v9/me/time_entries${d({since:t,meta:e})}`,n([()=>p(s)])))},timeEntryInvitations:{fetch:t=>this.get(`/api/v9/me/time_entry_invitations${d({since:t})}`),accept:(t,e)=>this.post(`/api/v9/workspaces/${t}/time_entry_invitations/${e}/accept`),reject:(t,e)=>this.post(`/api/v9/workspaces/${t}/time_entry_invitations/${e}/reject`)},timesheets:{list:t=>this.getPermissions().then(e=>this.get(`/api/v9/me/timesheets${t?`?${d(t)}`:""}`,n([()=>p(e)])))},unsubscribe:({code:t,unsubType:e})=>this.post(`/api/v9/me/${e}/${t}`),update:t=>this.put("/api/v9/me",{body:JSON.stringify(t)}),workspaces:{list:t=>this.getPermissions().then(e=>this.get(`/api/v9/me/workspaces${t?`?since=${t}`:""}`,n([()=>p(e)])))}},this.oauth={appleCallback:t=>{const e=new FormData;return e.set("code",t.authorization.code),e.set("id_token",t.authorization.id_token),e.set("user",JSON.stringify(t.user)),this.post("/api/v9/oauth/apple/callback",{body:e})},oauthUrl:t=>this.get(`/api/v9/oauth_url?state=${t}`)},this.organization={create:(t,e)=>this.getPermissions().then(s=>this.post("/api/v9/organizations",{body:JSON.stringify({name:t,workspace_name:e!=null?e:t}),...n([()=>p(s)])})),customer:{get:t=>this.get(`/api/v9/organizations/${t}/customer`),saveContactDetails:(t,e)=>this.post(`/api/v9/organizations/${t}/customer/contact_detail`,{body:JSON.stringify(e)})},get:t=>this.getPermissions().then(e=>this.get(`/api/v9/organizations/${t}`,n([()=>p(e)]))),groups:{create:(t,e)=>this.post(`/api/v9/organizations/${t}/groups`,{body:JSON.stringify(e)}),delete:(t,e)=>this.delete(`/api/v9/organizations/${t}/groups/${e}`),list:t=>this.get(`/api/v9/organizations/${t}/groups`),update:(t,e,s)=>this.put(`/api/v9/organizations/${t}/groups/${e}`,{body:JSON.stringify(s),headers:{deferred:"true"}})},metrics:{fetch:t=>this.get(`/api/v9/organizations/${t}/metrics`)},paymentRecords:{list:t=>this.get(`/api/v9/organizations/${t}/payment_records`)},plans:{list:t=>this.get(`/api/v9/organizations/${t}/plans`)},segmentation:{list:t=>this.get(`/api/v9/organizations/${t}/segmentation`),update:(t,e)=>this.put(`/api/v9/organizations/${t}/segmentation`,{body:JSON.stringify(e)})},saveFeedback:(t,e,s)=>this.post(`/api/v9/organizations/${t}/pricing_plans/${e}/feedback`,{body:JSON.stringify(s)}),update:(t,e)=>this.getPermissions().then(s=>this.put(`/api/v9/organizations/${t}`,{body:JSON.stringify(e),...n([()=>p(s)])})),users:{delete:(t,e)=>this.patch(`/api/v9/organizations/${t}/users`,{body:JSON.stringify({delete:e}),headers:{deferred:"true"}}),leave:t=>this.delete(`/api/v9/organizations/${t}/users/leave`),list:(t,e)=>{const s=d({sort_dir:e.name,page:e.page,only_admins:e.only_admins,active_status:e.active_status,roles:e.roles,groups:(e.groups||[]).join(","),workspaces:(e.workspaces||[]).join(","),filter:e.filter||""});return this.get(`/api/v9/organizations/${t}/users${s}`)},update:(t,e,s)=>this.put(`/api/v9/organizations/${t}/users/${e}`,{body:JSON.stringify(s)}),detailed:(t,e)=>{const s=d({sort_dir:e.name,page:e.page,active_status:e.active_status,only_admins:e.only_admins,roles:(e.roles||[]).join(","),groups:(e.groups||[]).join(","),workspaces:(e.workspaces||[]).join(","),filter:e.filter||"",user_ids:(e.user_ids||[]).join(",")});return this.get(`/api/v9/organizations/${t}/users/detailed${s}`)}},workspaces:{addAssignments:(t,e,s)=>this.put(`/api/v9/organizations/${t}/workspaces/${e}/assignments`,{body:JSON.stringify(s)}),create:(t,e)=>this.getPermissions().then(s=>this.post(`/api/v9/organizations/${t}/workspaces`,{body:JSON.stringify(e),...n([()=>p(s)])})),groups:{list:(t,e)=>this.get(`/api/v9/organizations/${t}/workspaces/${e}/groups`)},leave:(t,e,s)=>this.patch(`/api/v9/organizations/${t}/workspaces/${e}/workspace_users`,{body:JSON.stringify({delete:s})}),statistics:t=>this.get(`/api/v9/organizations/${t}/workspaces/statistics`),users:{list:(t,e,s={})=>{const i=d(s);return this.get(`/api/v9/organizations/${t}/workspaces/${e}/workspace_users${i}`)}}},owner:{createTransfer:(t,e)=>this.post(`/api/v9/organizations/${t}/owner/transfer`,{body:JSON.stringify({new_owner_id:e})}),get:t=>this.get(`/api/v9/organizations/${t}/owner`),getTransfers:(t,e=!1)=>this.get(`/api/v9/organizations/${t}/owner/transfer?ongoing=${e}`),updateTransfer:(t,e,s)=>this.post(`/api/v9/organizations/${t}/owner/transfer/${e}/${s}`)},subscription:{delete:(t,e)=>this.delete(`/api/v9/organizations/${t}/subscription${e?"?immediateCancel=true":""}`),get:t=>this.get(`/api/v9/organizations/${t}/subscription`),calculate:(t,e,s=12)=>this.post(`/api/v9/organizations/${t}/subscription/calculate`,{body:JSON.stringify({user_count:e,period:s})}),purchaseOrders:{create:(t,e)=>this.post(`/api/v9/organizations/${t}/subscription/purchase_orders`,{body:JSON.stringify({user_count:e})})},update:(t,e)=>this.post(`/api/v9/organizations/${t}/subscription`,{body:JSON.stringify(e)})},subscriptionNext:{get:t=>this.get(`/api/v9/organizations/${t}/subscription`),create:(t,e)=>this.post(`/api/v9/organizations/${t}/subscription`,{body:JSON.stringify({pricing_plan_tag:e})}),update:(t,e)=>this.put(`/api/v9/organizations/${t}/subscription`,{body:JSON.stringify({pricing_plan_tag:e})}),createSetupIntent:t=>this.post(`/api/v9/organizations/${t}/subscription/setup_intent`),customer:{get:t=>this.get(`/api/v9/organizations/${t}/subscription/customer`),create:(t,e,s,i,r,o,g,m)=>this.post(`/api/v9/organizations/${t}/subscription/customer`,{body:JSON.stringify({customer_name:e,toggl_user_email:s,postal_code:i,country_code:r,state:o,tax_number:g,address_line:m})}),update:(t,e,s,i,r,o,g,m)=>this.put(`/api/v9/organizations/${t}/subscription/customer`,{body:JSON.stringify({customer_name:e,toggl_user_email:s,postal_code:i,country_code:r,state:o,tax_number:g,address_line:m})})},promoCode:{apply:(t,e)=>this.post(`/api/v9/organizations/${t}/subscription/promocode`,{body:JSON.stringify({code:e})}),delete:t=>this.delete(`/api/v9/organizations/${t}/subscription/promocode`)},invoices:{list:t=>this.get(`/api/v9/organizations/${t}/payment_records?is_unified=true`),next:(t,e)=>this.get(`/api/v9/organizations/${t}/payment_records?is_unified=true&next=${e}`),prev:(t,e)=>this.get(`/api/v9/organizations/${t}/payment_records?is_unified=true&prev=${e}`)},invoiceSummary:{fetch:t=>this.get(`/api/v9/organizations/${t}/subscription/invoice_summary`),calculate:(t,e,s)=>this.get(`/api/v9/organizations/${t}/subscription/invoice_summary?pricing_plan_tag=${e}&quantity=${s}`)},trial:{start:t=>this.post(`/api/v9/organizations/${t}/subscription/trial`)}},invitations:{accept:t=>this.post(`/api/v9/organizations/invitations/${t}/accept`),invite:(t,e)=>this.post(`/api/v9/organizations/${t}/invitations`,{body:JSON.stringify(e)}),reject:t=>this.post(`/api/v9/organizations/invitations/${t}/reject`),resend:(t,e)=>this.put(`/api/v9/organizations/${t}/invitations/${e}/resend`)}},this.payments={subscribe:t=>this.post("/payment_wrapper",{body:JSON.stringify(t)}),updateCardDetails:(t,e)=>this.post("/payment_gateway/api/v1/stripe",{body:JSON.stringify({workspace_id:t,stripeToken:e})}),updateOrganizationCardDetails:(t,e)=>this.post("/payment_gateway/api/v1/stripe",{body:JSON.stringify({organization_id:t,stripeToken:e})})},this.plan={me:()=>this.get("/api/v5/me",{credentials:"include"},"plan"),projects:t=>this.get(`/api/v5/${t}/projects`,{credentials:"include"},"plan"),tasks:(t,e,s,i)=>this.get(`/api/v5/${t}/tasks?since=${s}&until=${i}&short=true&users[]=${e}`,{credentials:"include"},"plan"),planProject:t=>this.get(`/api/v4/me/track/plan_project?track_project_id=${t}`,{credentials:"include"},"plan"),workspace:t=>this.get(`/api/v4/workspaces/${t}`,{credentials:"include"},"plan")},this.project={bulkEdit:(t,e,s)=>this.patch(`/api/v9/workspaces/${t}/projects/${e.join(",")}`,{body:JSON.stringify(s)}),create:(t,e)=>this.getPermissions().then(s=>this.post(`/api/v9/workspaces/${t}/projects`,{body:JSON.stringify(e),...n([()=>p(s)])})),createProjectGroup:(t,e)=>this.post(`/api/v9/workspaces/${t}/project_groups`,{body:JSON.stringify(e)}),createProjectUser:(t,e)=>this.post(`/api/v9/workspaces/${t}/project_users`,{body:JSON.stringify(e)}),delete:(t,e,s)=>this.delete(`/api/v9/workspaces/${t}/projects/${e}?teDeletionMode=${s}`),deleteProjectGroup:(t,e)=>this.delete(`/api/v9/workspaces/${t}/project_groups/${e}`),deleteProjectUser:(t,e)=>this.delete(`/api/v9/workspaces/${t}/project_users/${e}`),fetchProjectsBillableAmounts:(t,e)=>this.post(`/api/v9/workspaces/${t}/projects/billable-amounts`,{body:JSON.stringify({project_ids:e})}),fetchProjectById:(t,e,s={})=>{const i=d(s);return this.getPermissions().then(r=>this.get(`/api/v9/workspaces/${t}/projects/${e}${i}`,n([()=>p(r)])))},fetchProjectGroups:t=>this.get(`/api/v9/workspaces/${t}/project_groups`),fetchProjectsPage:(t,e,s,i)=>{const r={actual_hours:!0,active:!0,force:!1,page:e,...i,...s,billable:(s==null?void 0:s.billable)==null?"both":s.billable},o=d(r);return this.getPermissions().then(g=>this.get(`/api/v9/workspaces/${t}/projects${o}`,n([()=>p(g)])))},fetchProjectSummary:(t,e,s,i)=>{const r=s&&i?{start_date:s,end_date:i}:null;return this.post(`/reports/api/v3/workspace/${t}/projects/${e}/summary`,{body:r?JSON.stringify(r):null})},fetchProjectUsers:(t,e)=>{const s=e?{project_ids:e.join(",")}:null;let i;return s&&(i=d(s)),this.get(`/api/v9/workspaces/${t}/project_users${i||""}`)},fetchRecurringPeriods:(t,e)=>this.get(`/api/v9/workspaces/${t}/projects/${e}/periods`),update:(t,e,s)=>this.getPermissions().then(i=>this.put(`/api/v9/workspaces/${t}/projects/${e}`,{body:JSON.stringify(s),...n([()=>p(i)])})),updateProjectUser:(t,e,s)=>this.put(`/api/v9/workspaces/${t}/project_users/${e}`,{body:JSON.stringify(s)}),fetchProjectStatistics:(t,e)=>this.get(`/api/v9/workspaces/${t}/projects/${e}/statistics`)},this.pushService={create:t=>this.post("/api/v9/me/push_services",{body:JSON.stringify({fcm_registration_token:t})}),delete:t=>this.delete("/api/v9/me/push_services",{body:JSON.stringify({fcm_registration_token:t})})},this.reportExports={summary:(t,e,s)=>this.post(`exports/api/v1/summary.${s}`,{body:JSON.stringify({...e,workspace_id:t})}),detailed:(t,e,s)=>this.post(`exports/api/v1/detailed.${s}`,{body:JSON.stringify({...e,workspace_id:t})}),weekly:(t,e,s)=>this.post(`exports/api/v1/weekly.${s}`,{body:JSON.stringify({...e,workspace_id:t})})},this.reports={filters:{projects:(t,e)=>this.post(`/reports/api/v3/workspace/${t}/filters/projects`,{body:JSON.stringify(e)}),tasks:(t,e)=>this.post(`/reports/api/v3/workspace/${t}/filters/tasks`,{body:JSON.stringify(e)})},status:()=>this.get("/reports/api/v3/status"),workspace:{comparative:(t,e)=>this.post(`/reports/api/v3/workspace/${t}/comparative`,{body:JSON.stringify(e)}),dataTrends:{clients:(t,e)=>this.post(`/reports/api/v3/workspace/${t}/data_trends/clients`,{body:JSON.stringify(e)}),users:(t,e)=>this.post(`/reports/api/v3/workspace/${t}/data_trends/users`,{body:JSON.stringify(e)})},detailed:{timeEntries:{export:(t,e,s)=>this.post(`reports/api/v3/workspace/${t}/detailed/time_entries.${s}`,{body:JSON.stringify(e)}),legacyExportV2:(t,e)=>{const s=d(t);return this.get(`/reports/api/v2/details.${e}${s}`)}}},profitability:{employee:(t,e)=>this.post(`/reports/api/v3/workspace/${t}/profitability/employee`,{body:JSON.stringify(e)}),projects:(t,e)=>this.post(`/reports/api/v3/workspace/${t}/profitability/projects`,{body:JSON.stringify(e)})},search:{projects:{fetch:(t,{include_recurring_totals:e,...s})=>this.post(`/reports/api/v3/workspace/${t}/search/projects${d({include_recurring_totals:e})}`,{body:JSON.stringify(s)})},users:{fetch:(t,e)=>this.post(`/reports/api/v3/workspace/${t}/search/users`,{body:JSON.stringify(e)})},clients:{fetch:(t,e)=>this.post(`/reports/api/v3/workspace/${t}/search/clients`,{body:JSON.stringify(e)})},tasks:{fetch:(t,e)=>this.post(`/reports/api/v3/workspace/${t}/search/tasks`,{body:JSON.stringify(e)}),fetchById:(t,e)=>this.post(`/reports/api/v3/workspace/${t}/search/tasks`,{body:JSON.stringify({ids:e})})},timeEntries:{export:(t,e,s)=>this.post(`/reports/api/v3/workspace/${t}/search/time_entries.${s}`,{body:JSON.stringify(e)}),fetch:(t,e)=>this.post(`/reports/api/v3/workspace/${t}/search/time_entries`,{body:JSON.stringify(e)}),totals:{fetch:(t,e)=>this.post(`/reports/api/v3/workspace/${t}/search/time_entries/totals`,{body:JSON.stringify(e)})}}},summary:{timeEntries:{export:(t,e,s)=>this.post(`/reports/api/v3/workspace/${t}/summary/time_entries.${s}`,{body:JSON.stringify(e)}),fetch:(t,e)=>this.post(`/reports/api/v3/workspace/${t}/summary/time_entries`,{body:JSON.stringify({...e,include_time_entry_ids:!0})})}},weekly:{timeEntries:{export:(t,e,s)=>this.post(`/reports/api/v3/workspace/${t}/weekly/time_entries.${s}`,{body:JSON.stringify(e)}),fetch:(t,e)=>this.post(`/reports/api/v3/workspace/${t}/weekly/time_entries`,{body:JSON.stringify(e)})}}}},this.sharedProject={createUser:(t,e,s)=>this.post(`/api/v9/shared-project/${t}/user`,{body:JSON.stringify({name:e,email:s})})},this.sharedReport={exportReport:(t,e,s)=>this.post(`/reports/api/v3/shared/${t}/${e}`,{body:JSON.stringify(s)}),fetch:(t,{resource:e,chart_id:s,is_totals:i,...r})=>this.post(`/reports/api/v3/shared/${t}${d({resource:e,chart_id:s,is_totals:i})}`,{body:JSON.stringify(r)})},this.signup=t=>this.post("/api/v9/signup",{body:JSON.stringify(t)}),this.smail={contact:t=>this.post("/api/v9/smail/contact",{body:JSON.stringify(t)}),demo:t=>this.post("/api/v9/smail/demo",{body:JSON.stringify(t)}),master:t=>this.post("/api/v9/smail/master",{body:JSON.stringify(t)}),meet:t=>this.post("/api/v9/smail/meet",{body:JSON.stringify(t)})},this.status=()=>this.get("/api/v9/status"),this.tag={create:(t,e)=>this.getPermissions().then(s=>this.post(`/api/v9/workspaces/${e}/tags`,{body:JSON.stringify({name:t}),...n([()=>p(s)])})),delete:t=>this.delete(`/api/v9/workspaces/${t.workspace_id}/tags/${t.id}`),deleteBulk:(t,e)=>this.patch(`/api/v9/workspaces/${t}/tags`,{body:JSON.stringify({delete:e})}),update:t=>this.getPermissions().then(e=>this.put(`/api/v9/workspaces/${t.workspace_id}/tags/${t.id}`,{body:JSON.stringify({name:t.name}),...n([()=>p(e)])}))},this.tasks={bulkEdit:(t,e,s,i)=>this.patch(`/api/v9/workspaces/${t}/projects/${e}/tasks/${s.join(",")}`,{body:JSON.stringify(i)}),create:(t,e,s)=>this.getPermissions().then(i=>this.post(`/api/v9/workspaces/${t}/projects/${e}/tasks`,{body:JSON.stringify(s),...n([()=>p(i)])})),delete:(t,e,s)=>this.delete(`/api/v9/workspaces/${t}/projects/${e}/tasks/${s}`),fetch:(t,e)=>{const s={pid:e.pid.toString(),actual_hours:String(e.actual_hours),active:String(e.active),page:e.page.toString()};e.start_date&&(s.start_date=e.start_date),e.end_date&&(s.end_date=e.end_date),e.sort_order&&(s.sort_order=e.sort_order),e.sort_field&&(s.sort_field=e.sort_field);const i=new URLSearchParams(s).toString();return this.getPermissions().then(r=>this.get(`/api/v9/workspaces/${t}/tasks?${i}`,n([()=>p(r)])))},update:(t,e,s,i)=>this.getPermissions().then(r=>this.put(`/api/v9/workspaces/${t}/projects/${e}/tasks/${s}`,{body:JSON.stringify(i),...n([()=>p(r)])}))},this.timeEntry={bulkEdit:(t,e)=>this.patch(`/api/v9/time_entries/${t.join(",")}`,{body:JSON.stringify(e)}),create:(t,e=!1)=>this.getPermissions().then(s=>this.post(`/api/v9/time_entries${e?"?meta=true":""}`,{body:JSON.stringify(t),...n([()=>p(s)])})),delete:t=>this.delete(`/api/v9/time_entries/${t.id}`),get:t=>this.getPermissions().then(e=>this.get(`/api/v9/time_entries/${t}`,n([()=>p(e)]))),undoDelete:t=>this.patch(`/api/v9/time_entries/${t.join(",")}`,{body:JSON.stringify([{op:"remove",path:"/deleted_at"}])}),update:(t,e=!1,s={})=>{e&&(s.meta=e);const i=d(s);return this.getPermissions().then(r=>this.put(`/api/v9/time_entries/${t.id}${i}`,{body:JSON.stringify(t),...n([()=>p(r)])}))}},this.timeline=(t,e)=>this.get(`/api/v9/timeline?start_date=${t}&end_date=${e}`),this.timezones={fetch:()=>this.get("/api/v9/timezones"),offsets:()=>this.get("/api/v9/timezones/offsets")},this.webhooks={create:(t,e)=>this.post(`/webhooks/api/v1/subscriptions/${t}`,{body:JSON.stringify(e)}),delete:(t,e)=>this.delete(`/webhooks/api/v1/subscriptions/${t}/${e}`),fetch:t=>this.get(`/webhooks/api/v1/subscriptions/${t}`),ping:(t,e)=>this.post(`/webhooks/api/v1/ping/${t}/${e}`),status:()=>this.get("/webhooks/api/v1/status"),toggle:(t,e,s)=>this.patch(`/webhooks/api/v1/subscriptions/${t}/${s}`,{body:JSON.stringify({enabled:e})}),update:(t,e,s)=>this.put(`/webhooks/api/v1/subscriptions/${t}/${e}`,{body:JSON.stringify(s)}),fetchEventFilters:()=>this.get("/webhooks/api/v1/event_filters"),fetchEvents:(t,e)=>this.get(`/webhooks/api/v1/subscriptions/${t}/${e}/events`)},this.workspaces={alerts:{create:(t,e)=>this.post(`/api/v9/workspaces/${e}/alerts`,{body:JSON.stringify(t)}),update:t=>this.put(`/api/v9/workspaces/${t.wid}/alerts/${t.id}`,{body:JSON.stringify({source_kind:t.source_kind,project_id:t.project_id,threshold_type:t.threshold_type,thresholds:t.thresholds,receiver_roles:t.receiver_roles,receiver_users:t.receiver_users,receiver_groups:t.receiver_groups})}),delete:(t,e)=>this.delete(`/api/v9/workspaces/${e}/alerts/${t}`),fetch:t=>this.get(`/api/v9/workspaces/${t}/alerts`)},create:t=>this.getPermissions().then(e=>this.post("/api/v9/workspaces",{body:JSON.stringify(t),...n([()=>p(e)])})),currencies:{fetch:t=>this.get(`/api/v9/workspaces/${t}/currencies`)},dashboard:{fetchActivityByTimeEntry:(t,e)=>this.get(`/api/v9/workspaces/${t}/dashboard/top_activity${e?`?since=${e}`:""}`),fetchActivityByUser:(t,e)=>this.get(`/api/v9/workspaces/${t}/dashboard/all_activity${e?`?since=${e}`:""}`),fetchMostActive:(t,e)=>this.get(`/api/v9/workspaces/${t}/dashboard/most_active${e?`?since=${e}`:""}`)},exports:{start:(t,e)=>this.post(`/api/v9/workspaces/${t}/exports`,{body:JSON.stringify(e)}),status:t=>this.get(`/api/v9/workspaces/${t}/exports`)},fetch:t=>this.getPermissions().then(e=>this.get(`/api/v9/workspaces/${t}`,n([()=>p(e)]))),groups:{create:(t,e)=>this.post(`/api/v9/workspaces/${t}/groups`,{body:JSON.stringify({wid:t,name:e})}),delete:(t,e)=>this.delete(`/api/v9/workspaces/${t}/groups/${e}`),list:t=>this.get(`/api/v9/workspaces/${t}/groups`),update:(t,e,s)=>this.put(`/api/v9/workspaces/${t}/groups/${e}`,{body:JSON.stringify({name:s})})},iCal:{reset:t=>this.post(`/api/v9/workspaces/${t}/ical/reset`),set:(t,e)=>this.post(`/api/v9/workspaces/${t}/ical/toggle`,{body:JSON.stringify(e)})},linkedSsoProfiles:{fetch:t=>this.get(`/api/v9/workspaces/${t}/linked_sso_profiles`),create:(t,e)=>this.put(`/api/v9/workspaces/${t}/linked_sso_profiles/${e}`),delete:(t,e)=>this.delete(`/api/v9/workspaces/${t}/linked_sso_profiles/${e}`)},logo:{fetch:t=>this.get(`/api/v9/workspaces/${t}/logo`),remove:t=>this.delete(`/api/v9/workspaces/${t}/logo`),upload:(t,e)=>this.post(`/api/v9/workspaces/${t}/logo`,{body:e})},preferences:{fetch:t=>this.get(`/api/v9/workspaces/${t}/preferences`),update:(t,e)=>this.post(`/api/v9/workspaces/${t}/preferences`,{body:JSON.stringify(e)})},paymentRecords:{list:t=>this.get(`/api/v9/workspaces/${t}/payment_records`)},plans:{list:t=>this.get(`/api/v9/workspaces/${t}/plans`)},projects:{fetch:(t,e,s,i)=>{const r=d({page:e,since:s,client_ids:i==null?void 0:i.clientIds});return this.getPermissions().then(o=>this.get(`/api/v9/workspaces/${t}/projects${r}`,n([()=>p(o)])))}},rates:{create:(t,e)=>this.post(`/api/v9/workspaces/${t}/rates`,{body:JSON.stringify(e)}),delete:(t,e)=>this.delete(`/api/v9/workspaces/${t}/rates/${e}`),list:(t,e,s)=>this.get(`/api/v9/workspaces/${t}/rates/${e}/${s}`)},reminders:{create:t=>this.post(`/api/v9/workspaces/${t.workspace_id}/track_reminders`,{body:JSON.stringify(t)}),delete:(t,e)=>this.delete(`/api/v9/workspaces/${e}/track_reminders/${t}`),fetch:t=>this.get(`/api/v9/workspaces/${t}/track_reminders`),update:t=>this.put(`/api/v9/workspaces/${t.workspace_id}/track_reminders/${t.reminder_id}`,{body:JSON.stringify(t)})},reports:{shared:{create:(t,e)=>this.post(`/api/v9/workspaces/${t}/reports/shared`,{body:JSON.stringify(e)}),delete:(t,e)=>this.patch(`/api/v9/workspaces/${t}/reports/shared/bulk_delete`,{body:JSON.stringify({ids:e})}),get:(t,e)=>{const s=d(e);return this.get(`/api/v9/workspaces/${t}/reports/shared${s}`)},update:(t,e,s)=>this.put(`/api/v9/workspaces/${t}/reports/shared/${e}`,{body:JSON.stringify(s)})}},scheduledReports:{delete:(t,e)=>this.delete(`/api/v9/workspaces/${t}/scheduled_reports/${e}`),fetch:t=>this.get(`/api/v9/workspaces/${t}/scheduled_reports`),save:(t,e)=>this.post(`/api/v9/workspaces/${t}/scheduled_reports`,{body:JSON.stringify(e)})},sso:{deleteConfig:t=>this.delete(`/api/v9/workspaces/${t}/sso`),fetchConfig:t=>this.get(`/api/v9/workspaces/${t}/sso`),updateConfig:(t,e)=>this.post(`/api/v9/workspaces/${t}/sso`,{body:JSON.stringify(e)})},tags:{fetch:(t,e,s)=>{const i=d({page:e,since:s});return this.getPermissions().then(r=>this.get(`/api/v9/workspaces/${t}/tags${i}`,n([()=>p(r)])))}},templates:{fetch:t=>this.get(`/api/v9/workspaces/${t}/projects/templates`)},subscription:{acceptTermsOfService:t=>this.post(`/api/v9/workspaces/${t}/subscription/inc_accept`),acceptVat:t=>this.post(`/api/v9/workspaces/${t}/subscription/vat_accept`),calculate:(t,e,s)=>this.post(`/api/v9/workspaces/${t}/subscription/calculate`,{body:JSON.stringify({user_count:e,period:s})}),fetchSelectedFeatures:t=>this.get(`/api/v9/workspaces/${t}/subscription/selected_features`),get:t=>this.get(`/api/v9/workspaces/${t}/subscription`),purchaseOrders:{create:(t,e)=>this.post(`/api/v9/workspaces/${t}/subscription/purchase_orders`,{body:JSON.stringify({user_count:e})})},update:(t,e)=>this.post(`/api/v9/workspaces/${t}/subscription`,{body:JSON.stringify(e)})},timeEntries:{constraints:{fetch:t=>this.get(`/api/v9/workspaces/${t}/preferences/time_entry_constraints`),update:(t,e)=>this.post(`/api/v9/workspaces/${t}/preferences/time_entry_constraints`,{body:JSON.stringify(e)})},create:t=>this.getPermissions().then(e=>this.post(`/api/v9/workspaces/${t.workspace_id}/time_entries`,{body:JSON.stringify(t),...n([()=>p(e)])})),delete:(t,e)=>{const s={op:"add",path:"/deleted_at",value:new Date().toISOString()};return this.patch(`/api/v9/workspaces/${t}/time_entries/${e.join(",")}`,{body:JSON.stringify([s])})},update:t=>this.getPermissions().then(e=>this.put(`/api/v9/workspaces/${t.workspace_id}/time_entries/${t.id}`,{body:JSON.stringify(t),...n([()=>p(e)])}))},update:t=>this.getPermissions().then(e=>this.put(`/api/v9/workspaces/${t.id}`,{body:JSON.stringify(t),...n([()=>p(e)])})),users:{fetch:t=>this.get(`/api/v9/workspaces/${t}/workspace_users`),put:(t,e,s)=>this.put(`/api/v9/workspaces/${t}/users/${e}`,{body:JSON.stringify(s)}),removeWorkspaceUser:(t,e)=>this.delete(`/api/v9/workspaces/${t}/workspace_users/${e}`),updateWorkspaceUser:(t,e,s)=>this.put(`/api/v9/workspaces/${t}/workspace_users/${e}`,{body:JSON.stringify(s)})},invoices:{save:t=>this.post(`/api/v9/workspaces/${t.workspace_id}/invoices`,{body:JSON.stringify(t)}),list:(t,e=1)=>{const s=d({page:e,per_page:25});return this.get(`/api/v9/workspaces/${t}/invoices${s}`)},delete:(t,e)=>this.delete(`/api/v9/workspaces/${t}/invoices/${e}`)}}}}const A=async(a,t)=>{const e=await h.get("rememberProjectPer");if(e!=="none"){const s=await h.getLocal("defaultProjects")||"{}";await h.setLocal("defaultProjects",{...s,[e==="integration"?a.origin:a.url]:t})}},L=async(a,t)=>{var r,o,g,m,S;const e=a,s=await h.get("rememberProjectPer"),i=await h.get("defaultProject");if(t.type==="contentScript"&&s!=="none"&&!e.project_id){const f=await h.getLocal("defaultProjects")||{},b=await h.getLocal("projects");e.project_id=s==="integration"?f[t.origin]:f[t.url],e.billable=e.billable||((o=b[(r=e.project_id)!=null?r:""])==null?void 0:o.billable),e.workspace_id=(S=(m=b[(g=e.project_id)!=null?g:""])==null?void 0:m.workspace_id)!=null?S:e.workspace_id}if(!e.project_id&&i){const f=await h.getLocal("projects"),b=f[i];e.project_id=i,e.workspace_id=b.workspace_id,e.billable=e.billable||f[i].billable}return e},P=async a=>{var e;const t=Object.assign({},a);if(delete t.pid,delete t.tid,delete t.wid,delete t.uid,t.project_id){const i=(await h.getLocal("projects"))[t.project_id];t.workspace_id=i.workspace_id}if((e=t.tag_ids)!=null&&e.length){const s=await h.getLocal("tags"),i=t.tag_ids.map(r=>{var o;return(o=s[r])==null?void 0:o.name});t.tags=i}else t.tags=[];return delete t.tag_ids,t},l=new R({host:"https://track.toggl.com/api",version:"@toggl/track-extension 3.0.37",headers:{"X-Toggl-Client":"track-extension"},skipPermissionsDependency:!0,accountsHost:"https://accounts.toggl.com"}),M=a=>k.function(async()=>{try{const{data:t}=await l.me.get();return c.exports.action.setBadgeText({text:""}),t}catch{c.exports.action.setBadgeText({text:"x"}),c.exports.action.setBadgeTextColor({color:"#FFF"}),c.exports.action.setBadgeBackgroundColor({color:"#F00"}),await k.delete("user");return}},{cacheKey:()=>"user",maxAge:{hours:1},staleWhileRevalidate:{minutes:3},shouldRevalidate:()=>!!a})(),rt=async()=>{await l.me.logout(),await k.delete("user"),await c.exports.storage.local.clear(),c.exports.tabs.query({active:!0,currentWindow:!0}).then(a=>{a.forEach(t=>{c.exports.tabs.remove(t.id)})})},z=async(a=!1)=>{try{const e=(await l.me.workspaces.list(null).then(s=>s.data)).reduce((s,i)=>({...s,[i.id]:i}),{});return c.exports.storage.local.set({workspaces:e}),e}catch(t){throw u(t),t}},ot=async a=>{try{const t=await l.workspaces.preferences.fetch(a).then(e=>e.data);return c.exports.storage.local.set({workspacePreferences:t}),t}catch(t){throw u(t),t}},nt=async()=>{try{const a=await l.me.features.list().then(t=>t.data);return c.exports.storage.local.set({workspaceFeatures:a}),a}catch(a){throw u(a),a}},E=async(a=!1)=>{const{organizationFeatures:t}=await c.exports.storage.local.get("organizationFeatures");if(t&&!a)return t;try{const e=await l.me.features.organization.list().then(s=>s.data);return c.exports.storage.local.set({organizationFeatures:e}),e}catch(e){throw u(e),e}},w="time-tracking-reminder",O="reminder-notification",N=j({notification:{id:"notification.rememberTracking",defaultMessage:"Don't forget to track your time."},button:{id:"notification.button",defaultMessage:"Disable reminder"}});async function U(){if(!await h.get("remindersCheckEnabled"))return;const t=await y.alarms.get(w);t&&await y.alarms.clear(t.name),B()}async function B(){const a=await h.get("remindersInterval");y.alarms.create(w,{delayInMinutes:a}),y.alarms.onAlarm.addListener(async t=>{if(t.name===w){const[e,s]=await h.get("remindersFromTo");C.fromDateTimes(v.fromISO(e),v.fromISO(s)).contains(v.now())&&(y.notifications.create(O,{type:"basic",iconUrl:"images/icon-128.png",title:"Toggl Track",message:$.formatMessage(N.notification),buttons:[{title:$.formatMessage(N.button)}]}),y.notifications.onButtonClicked.addListener(r=>{r===O&&h.set("remindersCheckEnabled",!1)}))}})}async function W(){const a=await y.alarms.get(w);a&&await y.alarms.clear(a.name)}const q="te-constraints-notification",J=j({timeEntryConstraints:{id:"timeEntries.notifications.timeEntryConstraints",defaultMessage:"To stop the timer, add required {fields} field(s)."},requiredField:{id:"timeEntries.notifications.requiredFields",defaultMessage:"{field, select, description {description} tag {tag} project {project} task {task} other {Unknown}}"}});async function G(){const a=await M();if(!a)return new Promise((r,o)=>o(new Error("Can't fetch user data")));const t=a.default_workspace_id,e=await E(),s=await z(),i=e.find(r=>r.organization_id===s[t].organization_id);if(i!=null&&i.features.find(r=>r.name==="time_entry_constraints"&&r.enabled)){const r=await et(t);return new Promise(o=>o(r))}else return new Promise(r=>r(null))}async function V(a){const t=await T(),e=Object.values(t).find(s=>(s==null?void 0:s.duration)<0);!e||e&&x(e,null).then(()=>{y.runtime.sendMessage({type:"updateTEs"})})}async function x(a,t){var e;try{const s=t?v.fromISO(t):v.now(),i=v.fromISO(a.start);s<i&&tt(a);const r=await G(),o=D(r,a);if(o.length===0)return Z({...a,tag_ids:(e=a.tag_ids)!=null?e:[],stop:s.toISO(),duration:Math.floor(s.diff(i).as("seconds"))},{type:"popup"});y.notifications.create(q,{type:"basic",iconUrl:"images/icon-128.png",title:"Toggl Track",message:$.formatMessage(J.timeEntryConstraints,{fields:$.formatList(o.map(g=>$.formatMessage(J.requiredField,{field:g})))})})}catch(s){u(s)}}const _="toggl-track-pomodoro",H=async()=>{let a=chrome.runtime.getURL("src/content/audio/index.html");const t=c.exports.runtime.getURL("sounds/time_is_up_1.mp3");a+=`?volume=${await h.get("pomodoroSoundVolume")}&src=${t}&length=2000`,c.exports.windows.create({type:"popup",focused:!1,top:1,left:1,height:1,width:1,url:a})},Q=async()=>{if(!await h.get("pomodoroModeEnabled")||(await h.get("pomodoroSoundEnabled")&&H(),!await h.get("pomodoroStopTimeTrackingWhenTimerEnds")))return;const s=await T(),i=Object.values(s).find(o=>(o==null?void 0:o.duration)<0);if(!i)return;const r=await h.get("pomodoroInterval");i&&x(i,v.fromISO(i.start).plus({minutes:Number(r)}).toISO()).then(()=>{c.exports.runtime.sendMessage({type:"updateTEs"})})},K=async()=>{if(!await h.get("pomodoroModeEnabled"))return;const t=await h.get("pomodoroInterval");c.exports.alarms.create(_,{when:Date.now()+t*6e4})};c.exports.alarms.onAlarm.addListener(a=>{a.name===_&&Q()});const X=()=>{c.exports.alarms.clear(_)},pt=async()=>{var a;try{const{data:t}=await l.me.timeEntries.current();return t}catch(t){if(((a=t==null?void 0:t.response)==null?void 0:a.status)===404)return null;throw u(t),t}},T=async()=>{try{const{data:a}=await l.me.timeEntries.list(null),t=a.reduce((e,s)=>({...e,[s.id]:s}),{});return c.exports.storage.local.set({timeEntries:t}),t}catch(a){throw u(a),a}},Y=async(a,t)=>{try{await V();const e=await c.exports.storage.local.get("timeEntries"),s=Object.assign({},a);delete s.stop;const{data:i}=await l.workspaces.timeEntries.create({...s,created_with:`TrackExtension/3.0.37${t!=null&&t.source?`-${t.source}`:""}`});return await c.exports.storage.local.set({timeEntries:{...e.timeEntries,[i.id]:i}}),i}catch(e){throw u(e),e}},ct=async(a,t)=>{let e=await L(a,t);return e=await F(e,t),e=await P(a),W(),K(),h.set("tesListOnboardingStep","finished"),Y(e,t)},Z=async(a,t)=>{try{t.type==="contentScript"&&A(t,a.project_id);const e=await P(a);U();const s=await c.exports.storage.local.get("timeEntries"),i=Object.values(s==null?void 0:s.timeEntries).find(o=>(o==null?void 0:o.duration)<0);!!i&&a.id===i.id&&a.duration>0&&X(),delete e.stop;const{data:r}=await l.workspaces.timeEntries.update(e);return await c.exports.storage.local.set({timeEntries:{...s==null?void 0:s.timeEntries,[r.id]:r}}),r}catch(e){throw u(e),e}},tt=async a=>{try{await l.workspaces.timeEntries.delete(a.workspace_id,[a.id]),c.exports.storage.local.get("timeEntries").then(t=>{const e=t.timeEntries;delete e[a.id],c.exports.storage.local.set({timeEntries:e})})}catch(t){throw u(t),t}},et=async a=>{try{const t=await E(),e=await z(),s=t.find(o=>o.organization_id===e[a].organization_id),r=(s==null?void 0:s.features.find(o=>o.name==="time_entry_constraints"&&o.enabled))?await l.workspaces.timeEntries.constraints.fetch(a).then(o=>o.data):null;return await c.exports.storage.local.set({timeEntriesConstraints:r}),r}catch(t){throw u(t),t}};export{l as a,x as b,pt as c,T as d,et as e,M as f,E as g,nt as h,ot as i,z as j,W as k,rt as l,tt as r,ct as s,Z as u};
//# sourceMappingURL=timeEntry.js.map
