const eventName=Math.random().toString(36).substring(2)+crypto.getRandomValues(new Uint32Array(3)).join("");let shadowRoot,currentInfo,isLocationSpoofEnabled=!0,isScriptInjected=!1;function shouldInject(){return document instanceof HTMLDocument||document instanceof XMLDocument}function sendFirefoxEvent(){if("undefined"==typeof browser)return;const detail={coords:currentInfo.selectedLocation?.coords,fakeIt:["connected","connecting","disconnecting","reconnecting","connection_error"].includes(currentInfo.state)&&isLocationSpoofEnabled},event=new CustomEvent(eventName,{bubbles:!0,composed:!0,detail:JSON.stringify(detail)});shadowRoot?.dispatchEvent(event)}function inject(){let script=document.createElementNS("http://www.w3.org/1999/xhtml","script");script.src=chrome.runtime.getURL("/scripts/content/gps.js");let parent=document.head||document.body||document.documentElement,firstChild=parent.childNodes&&parent.childNodes.length>0?parent.childNodes[0]:null;firstChild?parent.insertBefore(script,firstChild):parent.appendChild(script),isScriptInjected=!0}function inject_firefox(){let shadowHost=document.createElement("div");shadowHost.style.display="none";let parent=document.head||document.body||document.documentElement,firstChild=parent.childNodes&&parent.childNodes.length>0?parent.childNodes[0]:null;firstChild?parent.insertBefore(shadowHost,firstChild):parent.appendChild(shadowHost),shadowRoot=shadowHost.attachShadow({mode:"closed"});let script=document.createElementNS("http://www.w3.org/1999/xhtml","script");script.appendChild(document.createTextNode("__GPSJS_CONTENT__".replace("hookGeo();",`hookGeo('${eventName}');`))),shadowRoot.appendChild(script),sendFirefoxEvent(),isScriptInjected=!0}chrome.storage.local.get(["currentInfo","prefs"],(function(storage){isLocationSpoofEnabled=storage.prefs.hideLocation,currentInfo=storage.currentInfo,shouldInject()&&!0===isLocationSpoofEnabled&&inject()})),chrome.storage.onChanged.addListener((changes=>{changes?.prefs?.newValue&&(isLocationSpoofEnabled=changes?.prefs?.newValue?.hideLocation),changes?.currentInfo?.newValue&&(currentInfo=changes?.currentInfo?.newValue),!0!==changes?.prefs?.newValue?.hideLocation||isScriptInjected||inject(),isScriptInjected&&sendFirefoxEvent()}));